---
title: "Summary"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Summary}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

```{r setup}
library(PETDiagnostics)
library(dplyr)
library(DT)
```

# Build the tables
# or use your own cdm connection, in which case the table needs to be added to the cdm (on how to do this, see the run_this.R script)
```{r}
cdm <-  PETDiagnostics::mockPregnancy(motherTable = NULL,
                          babyTable = NULL,
                          pregnancy_size = 100,
                          fetus_size = 110,
                          seed = 1)
```

## How many women and pregnancies are there?

```{r}
PETOverviewMother <- PETDiagnostics::getOverview(cdm$motherTable) 
DT::datatable(PETOverviewMother)
```


## How many pregnancies and fetuses are there?
```{r}
PETOverviewBaby <- PETDiagnostics::getOverview(cdm$babyTable) 
DT::datatable(PETOverviewBaby)
```


## How many pregnancies are there per year?
```{r}
AnnualPETOverviewMother <- PETDiagnostics::getAnnualOverview(cdm$motherTable)
DT::datatable(AnnualPETOverviewMother)
```

## How many missing values are there in the motherTable?
The first 8 variables (until pregnancy_single) should not have any missings because they are required variables, i.e. any unknown value is mapped to zero, any observations with missing values are not considered
  
```{r}
missingSummaryMother <- PETDiagnostics::getMissings(cdm$motherTable) 
DT::datatable(missingSummaryMother)
```

## How many missing values are there in the babyTable?
  
The first 2 variables (until fetus_id) should not have any missings because they are required variables, i.e. any unknown value is mapped to zero, any observations with missing values are not considered
  
```{r}
missingSummaryBaby <- PETDiagnostics::getMissings(cdm$babyTable) 
DT::datatable(missingSummaryBaby)
```

## How many unknown values are there in the motherTable?

```{r}
unknownSummaryMother <- PETDiagnostics::getUnknown(cdm$motherTable)
DT::datatable(unknownSummaryMother)
```



## How do dates and gestational age add up in the motherTable?
  
###  "different gestational age" means that the difference between pregnancy end date and start date is larger than 7 days
###  "match gestational age" means that it the difference between pregnancy end date and start date is equal or smaller than 7 days
###  "missing information" counts the missings in either gestational age, pregnancy end or start date (there shold not be any missings because it is a required variable)
###  "end before start" counts the occasions in which the pregnancy end date happened on or before the start date plus the minimum of pre-defined gestational age
###  "end after start" counts the occasions in which the pregnancy end date happened after the start date plus the minimum of pre-defined gestational age
  
```{r}
gestationalAgeMatch <- PETDiagnostics::summariseGestationalAge(cdm$motherTable,minGestAge_Days = 21)
DT::datatable(gestationalAgeMatch)
```

## What is the minimum and maximum of pregnancy start and end dates as well as the distribution of gestational age ?

```{r}
valueDatesAgeDist <- PETDiagnostics::getValueDatesAgeDist(cdm$motherTable)
DT::datatable(valueDatesAgeDist)
```


## How do outcome and mode of delivery add up in the motherTable?
  
### "no match" means that a elective termination or miscarriage has a vaginal or c-section delivery
### a "match" means that a livebirth, stillbirth, or mixed outcome has a vaginal or c-section delivery
### "missing/unknown information" counts the missing/unknown information in either pregnancy outcome or mode of delivery (there should not be any missings)

```{r}
outcomeModeMatch <- PETDiagnostics::checkOutcomeMode(cdm$motherTable)
DT::datatable(outcomeModeMatch)
```
## How do number of fetuses and liveborns add up in the motherTable?
  
### "relative number wrong"  means the number of fetuses is smaller than the number of liveborn 
### "relative number right"  means the number of fetuses is equal or larger than the number of liveborn 
### "missing relative number" counts the missing information in either pregnancy number of fetuses and liveborns
### "multiple wrong"  means that the variable pregnancy single does not add up with the pregnancy number fetus variable 
### "multiple right"  means that the variable pregnancy single adds up with the pregnancy number fetus variable 
### "missing multiple" counts the missing information in either pregnancy single or pregnancy number fetus

```{r}
fetusesLivebornNumber <- PETDiagnostics::checkFetusesLiveborn(cdm$motherTable)
DT::datatable(fetusesLivebornNumber)
```
## How do number of fetuses and liveborns add up in the motherTable?
  
### "single_not_align_with_noOfFetusId"  means the variable pregnancy single does not align with the number of fetuses in the babyTable
### "single_align_with_noOfFetusId"  means the variable pregnancy single is YES and the number of fetuses in the babyTable is 1
### "missing_single" counts the missing/unknown information in pregnancy single or pregnancy number fetus
### "noOfFetus_not_align_with_noOfFetusId"  means the variable pregnancy number fetus does not align with the number of fetuses in the babyTable 
### "noOfFetus_align_with_noOfFetusId"  means the variable pregnancy number fetus align with the number of fetuses in the babyTable
### "missing_noOfFetus" counts the missing information in pregnancy number fetus

```{r}
fetusIdMatch <- PETDiagnostics::checkFetusId(cdm$motherTable,cdm$babyTable)
DT::datatable(fetusIdMatch)
```


## How do number of fetuses and liveborns add up in the motherTable?

```{r}
valueWeightDist <- PETDiagnostics::getValueWeightDist(cdm$babyTable) 
DT::datatable(valueWeightDist)
```

## How does the missing/unknown data pattern of both tables, the motherTable and the babyTable look like?

```{r}
bitSetOverviewAll  <- PETDiagnostics::getBitSet(cdm$motherTable,cdm$babyTable)
DT::datatable(bitSetOverviewAll)
```


## How does the missing/unknown data pattern of the motherTable look like?

```{r}
bitSetOverviewMother  <- PETDiagnostics::getBitSet(cdm$motherTable,babyTable=NULL)
DT::datatable(bitSetOverviewMother)
```


## How does the missing/unknown data pattern of the babyTable look like?

```{r}
bitSetOverviewBaby  <- PETDiagnostics::getBitSet(motherTable=NULL,cdm$babyTable)
DT::datatable(bitSetOverviewBaby)
```


```{r, echo=FALSE}
  DBI::dbDisconnect(attr(cdm, "dbcon"), shutdown = TRUE)
```
