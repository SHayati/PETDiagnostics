<!DOCTYPE html>
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

<title>PETDiagnostics</title>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.6.0/build/styles/github.min.css">
<script src="https://cdn.jsdelivr.net/combine/gh/highlightjs/cdn-release@11.6.0/build/highlight.min.js,npm/@xiee/utils/js/load-highlight.js" async></script>



<style type="text/css">
body, td {
  font-family: sans-serif;
  background-color: white;
  font-size: 13px;
}
body {
  max-width: 800px;
  margin: auto;
  padding: 1em;
  line-height: 1.5;
}
tt, code, pre {
  font-family: 'DejaVu Sans Mono', 'Droid Sans Mono', 'Lucida Console', Consolas, Monaco, monospace;
}
a:visited { color: #80007f; }
pre, img { max-width: 100%; }
code {
  font-size: 92%;
  border: 1px solid #ccc;
}
code[class] { background-color: #F8F8F8; }
code.language-undefined { background-color: inherit; }
table {
  margin: auto;
  border-top: 1px solid #666;
  border-bottom: 1px solid #666;
}
table thead th { border-bottom: 1px solid #ddd; }
th, td { padding: 5px; }
thead, tfoot, tr:nth-child(even) { background: #eee; }
blockquote {
  color:#666;
  margin:0;
  padding-left: 1em;
  border-left: 0.5em #eee solid;
}
hr { border: 1px #ddd dashed; }

@media print {
  * {
    background: transparent !important;
    color: black !important;
    filter:none !important;
  }
  body {
    font-size: 12pt;
    max-width: 100%;
  }
  a, a:visited { text-decoration: underline; }
  hr {
    visibility: hidden;
    page-break-before: always;
  }
  pre, blockquote {
    padding-right: 1em;
    page-break-inside: avoid;
  }
  tr, img { page-break-inside: avoid; }
  img { max-width: 100% !important; }
  @page :left { margin: 15mm 20mm 15mm 10mm; }
  @page :right { margin: 15mm 10mm 15mm 20mm; }
  p, h2, h3 { orphans: 3; widows: 3; }
  h2, h3 { page-break-after: avoid; }
}
</style>



</head>

<body>
<!-- README.md is generated from README.Rmd. Please edit that file -->
<h1>PETDiagnostics</h1>
<!-- badges: start -->
<!-- badges: end -->
<p>The goal of PETDiagnostics is to assess feasibility of data sources to perform observational studies on pregnancy related topics using the pregnancy extension tables in OHDSI.</p>
<h2>Installation</h2>
<p>You can install the development version of PETDiagnostics like so:</p>
<pre><code class="language-r">install.packages(&quot;remotes&quot;)
remotes::install_github(&quot;oxford-pharmacoepi/PETDiagnostics&quot;)
</code></pre>
<h2>Example</h2>
<h1>Create a reference to data in the OMOP CDM format</h1>
<p>The PETDiagnostics package is designed to work with data in the OMOP CDM format, so our first step is to create a reference to the data using the CDMConnector package. Here we´ll generate an example reference with simulated data (to see how you would create a reference to your database please consult the CDMConnector package documentation).</p>
<pre><code class="language-r">library(PETDiagnostics)
library(CDMConnector)
#&gt; Warning: package 'CDMConnector' was built under R version 4.2.2
library(dplyr)
#&gt; Warning: package 'dplyr' was built under R version 4.2.2
#&gt; 
#&gt; Attaching package: 'dplyr'
#&gt; The following objects are masked from 'package:stats':
#&gt; 
#&gt;     filter, lag
#&gt; The following objects are masked from 'package:base':
#&gt; 
#&gt;     intersect, setdiff, setequal, union


# We first need to create a mock database with a cdm reference
# this function creates a motherTable and a babyTable
cdm&lt;-mockPregnancy(motherTable = NULL,
                          babyTable = NULL,
                          pregnancy_size = 100,
                          fetus_size = 110,
                          seed = 1)

# this is what the table(s) look like
# use the motherTable and/or the babyTable depending on your data
head(cdm$motherTable)
#&gt; # Source:   SQL [6 x 16]
#&gt; # Database: DuckDB 0.5.1 [tburkard@Windows 10 x64:R 4.2.1/:memory:]
#&gt;   pregn…¹ perso…² pregnanc…³ pregnanc…⁴ gesta…⁵ pregn…⁶ pregn…⁷ pregn…⁸ pregn…⁹ pregn…˟ pregn…˟ prev_…˟ pregn…˟ pregn…˟ pregn…˟ pregn…˟
#&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;date&gt;     &lt;date&gt;       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;   &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;     &lt;int&gt;
#&gt; 1 1       68      2010-12-05 2011-02-01      58 4092289 4015701 4188539      NA       5       5 4012561      71 56366   77299   4188540
#&gt; 2 2       39      2004-09-01 2005-02-21     173 4081422       0 4188540 4242253       5       4 4012561      69 58034   63128   4188540
#&gt; 3 3       1       2019-10-03 2020-01-19     108 4092289       0 4188540 4053842       9       1 4102166      26 61510   57670   4188540
#&gt; 4 4       34      2001-05-15 2002-01-08     238  443213       0 4188539 4338692       1       8 4102166      78 72276   72594   4188539
#&gt; 5 5       87      2010-05-15 2011-01-14     244 4092289 4125611 4188540 4242253       1       9 4012561      56 69413   60329   4188539
#&gt; 6 6       43      2018-03-21 2018-08-13     145  443213       0 4188539 4242253      10       8 4012561      75 66483   59881   4188539
#&gt; # … with abbreviated variable names ¹​pregnancy_id, ²​person_id, ³​pregnancy_start_date, ⁴​pregnancy_end_date, ⁵​gestational_length_in_day,
#&gt; #   ⁶​pregnancy_outcome, ⁷​pregnancy_mode_delivery, ⁸​pregnancy_single, ⁹​pregnancy_marital_status, ˟​pregnancy_number_fetuses,
#&gt; #   ˟​pregnancy_number_liveborn, ˟​prev_pregnancy_parity, ˟​pregnancy_BMI, ˟​pregnancy_outcome_source_value,
#&gt; #   ˟​pregnancy_mode_delivery_source_value, ˟​pregnancy_folic
head(cdm$babyTable)
#&gt; # Source:   SQL [6 x 6]
#&gt; # Database: DuckDB 0.5.1 [tburkard@Windows 10 x64:R 4.2.1/:memory:]
#&gt;   pregnancy_id fetus_id birth_outcome birth_weight birth_con_malformation birth_APGAR
#&gt;   &lt;chr&gt;        &lt;chr&gt;            &lt;dbl&gt;        &lt;int&gt;                  &lt;int&gt;       &lt;int&gt;
#&gt; 1 1            1              4092289         2447                4188540           0
#&gt; 2 2            2              4092289         1827                4188540           9
#&gt; 3 3            3              4092289         1056                4188539           0
#&gt; 4 4            4                   NA          786                4188539           2
#&gt; 5 5            5              4092289         3716                4188540           9
#&gt; 6 6            6               443213         4201                4188540           6
</code></pre>
<h2>Execute the diagnostic checks of your table(s)</h2>
<h1>if both tables are available, all checks are possible</h1>
<h1>if only the motherTable is available, the “fetusid” check is not possible, put babyTable = NULL</h1>
<h1>if only the babyTable is available, only the “overview” and “missing” check is possible, put motherTable = NULL</h1>
<pre><code class="language-r">resultList &lt;- executeChecks (
                          motherTable = cdm$motherTable,               
                          babyTable = cdm$babyTable,                  
                          checks = c(&quot;overview&quot;, &quot;missing&quot;, &quot;gestationalAge&quot;, &quot;outcomeMode&quot;, &quot;fetusesLiveborn&quot;,
                                     &quot;fetusid&quot;),                       
                          minCellCount = 5,
                          verbose = FALSE)
#&gt; Error in executeChecks(motherTable = cdm$motherTable, babyTable = cdm$babyTable, : could not find function &quot;executeChecks&quot;
</code></pre>
<h2>Exporting results</h2>
<h1>resultList is the named list with results</h1>
<h1>databaseId is the database identifier</h1>
<h1>outputFolder is the folder to write to</h1>
<pre><code class="language-r">writeResultToDisk &lt;- function(resultList = resultList, databaseId, outputFolder)
#&gt; Error: &lt;text&gt;:2:0: unexpected end of input
#&gt; 1: writeResultToDisk &lt;- function(resultList = resultList, databaseId, outputFolder)
#&gt;    ^
</code></pre>


<script src="https://cdn.jsdelivr.net/combine/npm/@xiee/utils/js/center-img.min.js" async></script>
</body>

</html>
